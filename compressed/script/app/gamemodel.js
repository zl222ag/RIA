define(["backbone","text"],function(e){return e.Model.extend({defaults:{HEADER_TEXT:"The Insert Text Game!",DEFAULT_LANG:"en",WORDLISTS_DIRECTORY:"wordlists/",WORDLIST_EXTENSION:".txt",words:[],storedWords:[],wordId:0,currentLetterId:0,score:0,mode:"normal",lang:null},storedModel:new(e.Model.extend({defaults:{score:0},localStorage:new e.LocalStorage("GameData"),validate:function(e){if(typeof e.score!="number"||e.score<0)return"model.score must be a number and cannot possibly lower than 0. Got a "+typeof e.score+" with value "+e.score+"."},initialize:function(){this.fetch()}})),MODE_FORMAT:/^(long|short|normal)$/i,NUMBER_OF_WORDS:50,LANG_FORMAT:/^[a-z]{2}$/,validate:function(e){if(!(e.words instanceof Array))return"model.words can only be a string array. Got: "+e.words+".";if(!(e.storedWords instanceof Array))return"model.words can only be a string array. Got: "+e.storedWords+".";if(e.wordId<0||e.wordId>=e.words.length&&e.wordId!==0)return"model.wordId cannot be less than 0 or greater than the size of model.words. Got: "+e.wordId+".";if(e.currentLetterId<0||e.words.length>0&&e.currentLetterId>e.words[e.wordId].length)return"model.currentLetterId cannot be less than 0 or greater than the length of thecurrent model.word ("+e.words[e.wordId].length+"). Got: "+e.currentLetterId+".";if(typeof e.score!="number"||e.score<0)return"model.score must be a number and cannot possibly lower than 0. Got a "+typeof e.score+" with value "+e.score+".";if(!this.MODE_FORMAT.test(e.mode))return"Invalid mode!"},getCurrentWord:function(){return this.get("words")[this.get("wordId")]},getScore:function(){return this.get("score")},getHighscore:function(){return this.storedModel.get("score")},guessChar:function(e){var t=this.get("currentLetterId");return this.getCurrentWord()[t]!==e?!1:(t+=1,t>=this.getCurrentWord().length?(this.deletePastWord(),!this.pickWord()&&this.getScore()>this.getHighscore()&&this.trigger("highscore","new high-score "+this.getScore().toString()+", congratulations!")):this.set("currentLetterId",t,{validate:!0}),!0)},deletePastWord:function(){this.get("words").pop(this.get("wordId"))},pickWord:function(){var e=this.get("words").length;return e<1?(this.set("currentLetterId",0),this.set("wordId",0),!1):(this.set("currentLetterId",0,{validate:!0}),this.set("wordId",Math.floor(Math.random()*e),{validate:!0}),!0)},getWordList:function(){var e=this;require(["text!"+this.get("WORDLISTS_DIRECTORY")+this.get("lang")+this.get("WORDLIST_EXTENSION")+"!strip"],function(t){e.set("words",$.grep(t.trimLeft().trimRight().split(/\r\n|\r|\n/g),e.cleanArrayFilter),{validate:!0}),e.pickWord()},function(){e.get("lang")===e.get("DEFAULT_LANG")?alert("Couldn't load the wordlist =(."):(e.set("lang",e.get("DEFAULT_LANG"),{validate:!0}),e.getWordList())})},cleanArrayFilter:function(e){return typeof e=="string"&&e.length>0},initialize:function(){var e=0,t=null;t=navigator.language||navigator.userLanguage,e=t.indexOf("-"),e>0?this.set("lang",t.substr(0,e),{validate:!0}):this.set("lang",t,{validate:!0})}})});