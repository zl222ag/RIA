define(["backbone","text"],function(e){return e.Model.extend({defaults:{HEADER_TEXT:"The Insert Text Game!",DEFAULT_LANG:"en",WORDLISTS_DIRECTORY:"wordlists/",WORDLIST_EXTENSION:".txt",words:[],wordId:0,currentLetterId:0,score:0,lang:null},LANG_FORMAT:/^[a-z]{2}$/,validate:function(e){if(!(e.words instanceof Array))return"model.words can only be a string array. Got: "+e.words+".";if(e.wordId<0||e.wordId>=e.words.length&&e.wordId!==0)return"model.wordId cannot be less than 0 or greater than the size of model.words. Got: "+e.wordId+".";if(e.currentLetterId<0||e.words.length>0&&e.currentLetterId>e.words[e.wordId].length)return"model.currentLetterId cannot be less than 0 or greater than the length of the current model.word ("+e.words[e.wordId].length+"). Got: "+e.currentLetterId+".";if(e.score<0)return"model.score cannot possibly be lower than 0. Got: "+e.score+"."},getCurrentWord:function(){return this.get("words")[this.get("wordId")]},guessChar:function(e){var t=this.get("currentLetterId");return this.getCurrentWord()[t]!==e?!1:(t+=1,t>=this.getCurrentWord().length?(this.deletePastWord(),this.pickWord()):this.set("currentLetterId",t,{validate:!0}),!0)},deletePastWord:function(){this.get("words").pop(this.get("wordId"))},pickWord:function(){this.set("currentLetterId",0,{validate:!0}),this.set("wordId",Math.floor(Math.random()*this.get("words").length),{validate:!0})},getWordList:function(){var e=this;require(["text!"+this.get("WORDLISTS_DIRECTORY")+this.get("lang")+this.get("WORDLIST_EXTENSION")+"!strip"],function(t){e.set("words",t.trimLeft().trimRight().split(/\n+/),{validate:!0}),e.pickWord()},function(){e.get("lang")===e.get("DEFAULT_LANG")?alert("Couldn't load the wordlist =(."):(e.set("lang",e.get("DEFAULT_LANG"),{validate:!0}),e.getWordList())})},initialize:function(){var e=0,t=null;this.on("invalid",function(e,t){alert("Error: "+t)}),t=navigator.language||navigator.userLanguage,e=t.indexOf("-"),e>0?this.set("lang",t.substr(0,e),{validate:!0}):this.set("lang",t,{validate:!0})}})});